# ğŸ“Š Implementation Architecture & Flow Diagrams

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React + Vite)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Profile.jsx          Dashboard.jsx         AddStudentModal.jsx â”‚
â”‚  (Handle Display)     (Teacher Controls)    (Handle Input)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚                      â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ AXIOS
                        HTTP Requests & Responses
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API GATEWAY (Express)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Routes: /api/auth, /api/classrooms, /api/tests                â”‚
â”‚  Middleware: authMiddleware â†’ loadResource â†’ requireOwnership   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                       â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Auth Routes   â”‚    â”‚ Classroom     â”‚   â”‚ Test Routes      â”‚
    â”‚ /auth/*       â”‚    â”‚ Routes        â”‚   â”‚ /tests/*         â”‚
    â”‚               â”‚    â”‚ /classrooms/* â”‚   â”‚                  â”‚
    â”‚ Controllers:  â”‚    â”‚               â”‚   â”‚ Controllers:     â”‚
    â”‚ - register    â”‚    â”‚ Controllers:  â”‚   â”‚ - generateTest   â”‚
    â”‚ - login       â”‚    â”‚ - create      â”‚   â”‚ - getTest        â”‚
    â”‚ - getCurrentU â”‚    â”‚ - enroll      â”‚   â”‚ - submitTest     â”‚
    â”‚ - updateProfi â”‚    â”‚ - getTests    â”‚   â”‚ - getTestPreview â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                  â”‚                     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  DATABASE (MongoDB) â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ collections:       â”‚
                    â”‚ - users            â”‚
                    â”‚   â””â”€ handle        â”‚
                    â”‚ - classrooms       â”‚
                    â”‚   â””â”€ teacherId     â”‚
                    â”‚   â””â”€ students[]    â”‚
                    â”‚ - tests            â”‚
                    â”‚   â””â”€ teacherId     â”‚
                    â”‚   â””â”€ classroomId   â”‚
                    â”‚ - results          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¤ User Registration & Handle Flow

```
Student Registers
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/register         â”‚
â”‚ { name, email, password }       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authController.register()        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Hash password                 â”‚
â”‚ 2. Call generateUniqueHandle()   â”‚
â”‚    â””â”€ name â†’ name_XXXX           â”‚
â”‚    â””â”€ Check uniqueness (indexed) â”‚
â”‚    â””â”€ Retry up to 10 times       â”‚
â”‚ 3. Create user record            â”‚
â”‚    â”œâ”€ email                      â”‚
â”‚    â”œâ”€ password (hashed)          â”‚
â”‚    â””â”€ handle âœ… NEW              â”‚
â”‚ 4. Send JWT token               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
Frontend stores token & user data
           â”‚
           â–¼
Navigate to Profile Page
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Profile.jsx                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GET /api/auth/me             â”‚
â”‚        â”‚                     â”‚
â”‚        â–¼                     â”‚
â”‚ Display: @username_####      â”‚
â”‚          (with @ prefix)     â”‚
â”‚                              â”‚
â”‚ Edit button opens modal:     â”‚
â”‚ - Name: âœ… Editable          â”‚
â”‚ - Email: ğŸ”’ Locked          â”‚
â”‚ - Handle: ğŸ”’ Locked          â”‚
â”‚ - Bio: âœ… Editable           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Classroom Creation & Student Enrollment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEACHER: Create Classroom                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ Dashboard.jsx                                               â”‚
â”‚     â”‚                                                       â”‚
â”‚     â–¼                                                       â”‚
â”‚ GenerateTest.jsx (Create Classroom)                         â”‚
â”‚     â”‚                                                       â”‚
â”‚     â–¼                                                       â”‚
â”‚ POST /api/classrooms                                        â”‚
â”‚ { name, subject, handle }                                  â”‚
â”‚     â”‚                                                       â”‚
â”‚     â–¼                                                       â”‚
â”‚ classroomController.createClassroom()                       â”‚
â”‚     â”‚                                                       â”‚
â”‚     â”œâ”€ Set: teacherId = req.userId âœ…                      â”‚
â”‚     â”œâ”€ Create: Classroom record                            â”‚
â”‚     â””â”€ Log: "Classroom created by teacher X"               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEACHER: Add Student to Classroom                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ StudentsTab.jsx                                              â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚ AddStudentModal.jsx                                          â”‚
â”‚ Input: "@john_5678" or "john_5678"                           â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚ POST /api/classrooms/:id/students                           â”‚
â”‚ { userHandle: "john_5678" }                                 â”‚
â”‚     â”‚                                                        â”‚
â”‚     â–¼                                                        â”‚
â”‚ classroomRoutes.js                                           â”‚
â”‚ Middleware 1: loadResource(Classroom, 'id')                 â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ Load classroom from DB                               â”‚
â”‚     â””â”€ Set req.resource = classroom                         â”‚
â”‚                                                              â”‚
â”‚ Middleware 2: enrollStudent controller                       â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ Validate: teacher owns classroom                     â”‚
â”‚     â”‚    â””â”€ IF FALSE â†’ 403 Forbidden                        â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ Lookup: User.findOne({ handle: "john_5678" })        â”‚
â”‚     â”‚    â””â”€ IF NOT FOUND â†’ 404 Not Found                    â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ Check: Not already enrolled                          â”‚
â”‚     â”‚    â””â”€ IF ENROLLED â†’ 400 Conflict                      â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ ADD to classroom.students[]                          â”‚
â”‚     â”œâ”€ ADD to user.classrooms[]                             â”‚
â”‚     â”œâ”€ Save changes                                         â”‚
â”‚     â”‚                                                        â”‚
â”‚     â””â”€ Log: "Student enrolled: john_5678"                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Test Creation & Access Control Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEACHER: Create Test in Classroom                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ GenerateTest.jsx                                         â”‚
â”‚ Select: Classroom ID                                     â”‚
â”‚ Input: Topic, difficulty, questions                      â”‚
â”‚     â”‚                                                    â”‚
â”‚     â–¼                                                    â”‚
â”‚ POST /api/classrooms/:id/tests                          â”‚
â”‚ { topic, difficulty, questions, ... }                   â”‚
â”‚     â”‚                                                    â”‚
â”‚     â–¼                                                    â”‚
â”‚ classroomRoutes.js                                       â”‚
â”‚ Middleware: loadResource + requireOwnership              â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Load classroom                                   â”‚
â”‚     â””â”€ Check: teacherId === req.userId                  â”‚
â”‚        â””â”€ IF FALSE â†’ 403 Forbidden                      â”‚
â”‚                                                          â”‚
â”‚     â–¼                                                    â”‚
â”‚ classroomController.createClassroomTest()               â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Create Test with:                                â”‚
â”‚     â”‚  â”œâ”€ createdBy: teacherId âœ…                       â”‚
â”‚     â”‚  â”œâ”€ teacherId: teacherId âœ… NEW                   â”‚
â”‚     â”‚  â”œâ”€ classroomId: classroom._id âœ…                 â”‚
â”‚     â”‚  â””â”€ status: 'draft'                               â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Add test to classroom.tests[]                    â”‚
â”‚     â”œâ”€ Save changes                                     â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€ Log: "Test created: ABCD1234"                    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STUDENT: Access Test                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ TakeTest.jsx                                             â”‚
â”‚     â”‚                                                    â”‚
â”‚     â–¼                                                    â”‚
â”‚ GET /api/tests/:testId                                  â”‚
â”‚     â”‚                                                    â”‚
â”‚     â–¼                                                    â”‚
â”‚ testController.getTest()                                â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Load: Test from DB                               â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Check 1: Is it in a classroom?                   â”‚
â”‚     â”‚  â”œâ”€ YES:                                          â”‚
â”‚     â”‚  â”‚  â”œâ”€ Load classroom                             â”‚
â”‚     â”‚  â”‚  â”œâ”€ Check: Is user enrolled OR teacher?        â”‚
â”‚     â”‚  â”‚  â”‚   â”œâ”€ YES â†’ Continue                         â”‚
â”‚     â”‚  â”‚  â”‚   â””â”€ NO â†’ 403 Forbidden                     â”‚
â”‚     â”‚  â”‚  â”‚                                             â”‚
â”‚     â”‚  â””â”€ NO:                                           â”‚
â”‚     â”‚     â”œâ”€ Check: Is test public?                     â”‚
â”‚     â”‚     â”œâ”€ YES â†’ Continue                             â”‚
â”‚     â”‚     â””â”€ NO â†’ 403 Forbidden                         â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Check 2: Is test published?                      â”‚
â”‚     â”‚  â”œâ”€ If student & unpublished â†’ 403                â”‚
â”‚     â”‚  â””â”€ If teacher â†’ Show (draft OK)                  â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Return: Test data (without answers)              â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€ Log: "Test accessed: testId by user X"           â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STUDENT: Submit Test                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ TakeTest.jsx                                             â”‚
â”‚     â”‚                                                    â”‚
â”‚     â–¼                                                    â”‚
â”‚ POST /api/tests/submit                                  â”‚
â”‚ { testId, answers[], timeTaken }                        â”‚
â”‚     â”‚                                                    â”‚
â”‚     â–¼                                                    â”‚
â”‚ testController.submitTest()                             â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Load: Test from DB                               â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Check 1: Is it in a classroom?                   â”‚
â”‚     â”‚  â”œâ”€ YES:                                          â”‚
â”‚     â”‚  â”‚  â”œâ”€ Load classroom                             â”‚
â”‚     â”‚  â”‚  â”œâ”€ Check: Is user enrolled?                   â”‚
â”‚     â”‚  â”‚  â”‚   â”œâ”€ YES â†’ Continue                         â”‚
â”‚     â”‚  â”‚  â”‚   â””â”€ NO â†’ 403 Forbidden                     â”‚
â”‚     â”‚  â”‚  â”‚                                             â”‚
â”‚     â”‚  â””â”€ NO:                                           â”‚
â”‚     â”‚     â”œâ”€ Check: Is test public?                     â”‚
â”‚     â”‚     â”œâ”€ YES â†’ Continue                             â”‚
â”‚     â”‚     â””â”€ NO â†’ 403 Forbidden                         â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Check 2: Is test published?                      â”‚
â”‚     â”‚  â””â”€ NO â†’ 403 Forbidden                            â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€ Calculate score                                  â”‚
â”‚     â”œâ”€ Create Result record                             â”‚
â”‚     â”œâ”€ Save attempt to DB                               â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€ Log: "Result saved for test X"                   â”‚
â”‚                                                          â”‚
â”‚     â–¼                                                    â”‚
â”‚ Frontend: Show results                                  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authorization Middleware Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Incoming Request                        â”‚
â”‚ e.g., PUT /api/classrooms/:id           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Express Route Handler                    â”‚
â”‚ router.put('/:id',                       â”‚
â”‚   loadResource(Classroom, 'id'),         â”‚
â”‚   requireOwnership('teacherId'),         â”‚
â”‚   updateClassroom                        â”‚
â”‚ )                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Middleware 1: loadResource()              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Extract ID from req.params.id         â”‚
â”‚ 2. Query: Classroom.findById(id)         â”‚
â”‚ 3. IF NOT FOUND:                         â”‚
â”‚    â””â”€ Return: 404 Not Found              â”‚
â”‚ 4. IF FOUND:                             â”‚
â”‚    â””â”€ Set: req.resource = classroom      â”‚
â”‚    â””â”€ Call: next()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Middleware 2: requireOwnership()          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Get: fieldName = 'teacherId'          â”‚
â”‚ 2. Get: req.user.id (from auth)          â”‚
â”‚ 3. Get: req.resource.teacherId           â”‚
â”‚ 4. Compare:                              â”‚
â”‚    IF req.user.id === resource.teacherId â”‚
â”‚      â””â”€ Call: next()                     â”‚
â”‚    ELSE:                                 â”‚
â”‚      â””â”€ Log: "âš ï¸ Unauthorized access"    â”‚
â”‚      â””â”€ Return: 403 Forbidden            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller: updateClassroom()             â”‚
â”‚ (Only reaches here if authorized)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id                 â”‚
â”‚ name                â”‚
â”‚ email (unique)      â”‚
â”‚ handle (unique) âœ¨  â”‚ â† NEW field
â”‚ role                â”‚
â”‚ classrooms[]        â”‚ â”€â”€â”
â”‚ createdTests[]      â”‚ â”€â”€â”¼â”€â”
â”‚ attemptedTests[]    â”‚ â”€â”€â”¼â”€â”¼â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â”‚
          â”‚               â”‚ â”‚ â”‚
          â”‚ Teacher/      â”‚ â”‚ â”‚
          â”‚ Student       â”‚ â”‚ â”‚
          â”‚               â”‚ â”‚ â”‚
          â–¼               â”‚ â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”‚
â”‚    Classroom        â”‚â—„â”€â”€â”˜ â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚ â”‚
â”‚ _id                 â”‚     â”‚ â”‚
â”‚ teacherId           â”‚â”€â”€â”€â”€â”˜ â”‚
â”‚ students[]          â”‚       â”‚
â”‚ tests[]             â”‚â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”
â”‚ name                â”‚       â”‚ â”‚
â”‚ subject             â”‚       â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
                              â”‚ â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â”‚           â”‚
                    â–¼           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        Test                  â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ _id                          â”‚
        â”‚ createdBy                    â”‚
        â”‚ teacherId âœ¨ NEW             â”‚
        â”‚ classroomId                  â”‚
        â”‚ topic                        â”‚
        â”‚ difficulty                   â”‚
        â”‚ questions[]                  â”‚
        â”‚ duration                     â”‚
        â”‚ status                       â”‚
        â”‚ isPublished                  â”‚
        â”‚ isPublic                     â”‚
        â”‚ testCode                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ submissions
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        Result                â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ _id                          â”‚
        â”‚ userId                       â”‚
        â”‚ testId                       â”‚
        â”‚ score                        â”‚
        â”‚ answers[]                    â”‚
        â”‚ timeTaken                    â”‚
        â”‚ submittedAt                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Error Handling Flow

```
User Request
     â”‚
     â–¼
Authentication Check
     â”‚
     â”œâ”€ NO TOKEN â†’ 401 Unauthorized
     â”‚
     â””â”€ TOKEN VALID â†’ Continue
            â”‚
            â–¼
       Load Resource (if applicable)
            â”‚
            â”œâ”€ NOT FOUND â†’ 404 Not Found
            â”‚
            â””â”€ FOUND â†’ Continue
                   â”‚
                   â–¼
            Authorization Check
                   â”‚
                   â”œâ”€ NOT OWNER â†’ 403 Forbidden
                   â”‚
                   â””â”€ OWNER â†’ Continue
                          â”‚
                          â–¼
                   Business Logic
                          â”‚
                          â”œâ”€ INVALID DATA â†’ 400 Bad Request
                          â”œâ”€ CONFLICT â†’ 409 Conflict
                          â”‚
                          â””â”€ SUCCESS â†’ 200/201
                                 â”‚
                                 â–¼
                          Log Entry (âœ…, âš ï¸, or âŒ)
                                 â”‚
                                 â–¼
                          Response to Client
```

---

## ğŸ“ˆ Request/Response Examples

### Example 1: Student Registration
```
REQUEST:
POST /api/auth/register
Content-Type: application/json

{
  "name": "John Smith",
  "email": "john@example.com",
  "password": "secure123",
  "role": "student"
}

RESPONSE (200):
{
  "success": true,
  "token": "eyJhbGc...",
  "user": {
    "_id": "507f1f77bcf86cd799439011",
    "name": "John Smith",
    "email": "john@example.com",
    "handle": "john_5678",    â† AUTO-GENERATED
    "role": "student"
  }
}

SERVER LOG:
âœ… User registered with handle: john_5678
```

### Example 2: Add Student to Classroom
```
REQUEST:
POST /api/classrooms/507f1f77bcf86cd799439012/students
Authorization: Bearer token...
Content-Type: application/json

{
  "userHandle": "@john_5678"  or "john_5678"
}

RESPONSE (201):
{
  "success": true,
  "message": "Student enrolled successfully",
  "data": {
    "_id": "507f1f77bcf86cd799439011",
    "name": "John Smith",
    "handle": "john_5678",
    "email": "john@example.com",
    "enrolledDate": "2024-01-15T10:30:00Z"
  }
}

SERVER LOG:
âœ… Student enrolled: john_5678 (507f1f77bcf86cd799439011) in classroom 507f1f77bcf86cd799439012
```

### Example 3: Unauthorized Access
```
REQUEST:
PUT /api/classrooms/507f1f77bcf86cd799439012/
Authorization: Bearer otherTeacherToken...
Content-Type: application/json

{
  "name": "Updated Name"
}

RESPONSE (403):
{
  "success": false,
  "error": "Not authorized to modify this classroom"
}

SERVER LOG:
âš ï¸ Unauthorized access: user 507f1f77bcf86cd799439099 tried to access classroom 507f1f77bcf86cd799439012
```

---

**Documentation Complete** âœ…
**Version**: 1.0.0
**Generated**: 2024
